<?php

namespace App\Service;

class SlugifyProcessor
{
    /**
     * Преобразует текст в URL-friendly slug с поддержкой кириллицы
     *
     * Метод выполняет следующие преобразования:
     * - Приводит текст к нижнему регистру
     * - Транслитерирует кириллические символы в латиницу
     * - Заменяет пробелы и некоторые символы на дефисы
     * - Удаляет все символы кроме букв, цифр и дефисов
     * - Убирает множественные дефисы
     * - Удаляет дефисы в начале и конце строки
     *
     * @param string $text Исходный текст для преобразования
     * @return string URL-friendly slug
     *
     * @example
     * process('Привет, мир!') // возвращает 'privet-mir'
     * process('Game Title 2023') // возвращает 'game-title-2023'
     * process('Специальные символы: @#$%') // возвращает 'spetsialnye-simvoly'
     */
    public static function process(string $text): string
    {
        $text = mb_strtolower($text, 'UTF-8');

        $translit = [
            'а' => 'a','б' => 'b','в' => 'v','г' => 'g','д' => 'd','е' => 'e','ё' => 'e','ж' => 'zh','з' => 'z',
            'и' => 'i','й' => 'y', 'к' => 'k','л' => 'l','м' => 'm','н' => 'n','о' => 'o','п' => 'p','р' => 'r',
            'с' => 's','т' => 't','у' => 'u','ф' => 'f', 'х' => 'kh','ц' => 'ts','ч' => 'ch','ш' => 'sh','щ' => 'shch',
            'ъ' => '','ы' => 'y','ь' => '','э' => 'e','ю' => 'yu','я' => 'ya', ' ' => '-',',' => '',':' => '',
            ';' => '','.' => '','/' => '-','–' => '-', '—' => '-', '\'' => '','"' => '',
        ];

        $text = strtr($text, $translit);
        $text = preg_replace('~[^a-z0-9\-]+~u', '', $text);
        $text = preg_replace('~-+~', '-', (string)$text);
        return trim((string)$text, '-');
    }
}
